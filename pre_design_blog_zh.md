# 初步设计

## 工程需求分析

工程需求主要集中在事件驱动架构的核心组件：生产者、消费者、主题、分区以及消息生命周期。主要考虑事项包括：

- **消息生命周期**：理解消息如何创建、分配到分区以及被消费。
- **生产者和消费者**：区分生产者的随机和手动消息分配方式，以及消费者在消费者组中的角色。
- **分区管理**：分区如何创建、管理和在消费者之间重新平衡。
- **并发性**：确保在多线程环境中的线程安全和正确操作。
- **泛型**：允许事件负载类型的灵活性。

## 可用性测试清单

为验证系统功能，我们将制定一系列可用性测试，涵盖不同场景：

1. **主题管理**：创建、列出和删除主题。
2. **分区管理**：创建、分配和重新平衡主题中的分区。
3. **消费者组管理**：创建、修改和删除消费者组及其重新平衡策略。
4. **生产者操作**：创建生产者，支持随机/手动分配，并生成事件。
5. **消费者操作**：从分配的分区消费事件，并处理消息偏移量管理。
6. **事件重放**：测试从特定偏移量重放事件的功能。

## 初步 UML 图

![初步设计图](pre-design.png)

## Java API 设计

Java API 将按以下方式设计：

### API 组件

- **Topic**：主题管理接口。
- **Cluster**：包含多个主题的类。
- **Partition**：管理分区队列的类。
- **Producer**：生产事件的接口，提供 `RandomProducer` 和 `ManualProducer` 的实现。
- **Consumer**：消费事件的接口，提供具体的 `Consumer` 类。
- **ConsumerGroup**：管理消费者组及其重新平衡策略的类。

### 核心包

- 内部类，支持 API 但不暴露给最终用户。

## 测试计划

测试计划将包括：

- **单元测试**：测试各个独立组件。
- **集成测试**：测试组件之间的交互（例如生产者-消费者交互、重新平衡逻辑）。
- **可用性测试**：根据清单，确保 CLI 符合用户需求。

## 实现方法

我们将采用 **基于组件的方法**，理由如下：

1. **任务分工**：
    - 更容易进行任务分配。
    - 每个组件可以独立开发。

2. **早期问题检测**：
    - 通过单元测试及早发现问题。
    - 提前解决问题，减少后期集成时的困难，提高系统稳定性。

